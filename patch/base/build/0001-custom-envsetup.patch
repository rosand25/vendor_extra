From cdf2bed3bc7d5898e8f3c2b5957147939f484559 Mon Sep 17 00:00:00 2001
From: sub77 <darfpunk@gmx.de>
Date: Wed, 28 Dec 2016 23:41:15 +0000
Subject: [PATCH] custom envsetup

Change-Id: I9049bfa1c483f8796cd0bc070f3afe22f4098890
Signed-off-by: sub77 <darfpunk@gmx.de>
---
 envsetup.sh | 24 ++++++++++++++++++++++++
 1 file changed, 24 insertions(+)

diff --git a/envsetup.sh b/envsetup.sh
index a7f3c1e76..7624bde1e 100644
--- a/envsetup.sh
+++ b/envsetup.sh
@@ -283,6 +283,9 @@ function set_stuff_for_environment()
     setpaths
     set_sequence_number
 
+    patchcommontree
+    patchdevicetree
+
     export ANDROID_BUILD_TOP=$(gettop)
     # With this environment variable new GCC can apply colors to warnings/errors
     export GCC_COLORS='error=01;31:warning=01;35:note=01;36:caret=01;32:locus=01:quote=01'
@@ -1732,6 +1735,27 @@ function provision()
     "$ANDROID_PRODUCT_OUT/provision-device" "$@"
 }
 
+function patchcommontree()
+{
+for f in `test -d vendor && find -L vendor/extra/patch/common/  -name 'apply.sh' 2> /dev/null`
+do
+    echo -e ${CL_YLW}"\nPatching common-tree -> $f\n"${CL_RST}
+    . $f
+done
+unset f
+}
+
+function patchdevicetree()
+{
+for f in `test -d device && find -L device/*/$CUSTOM_BUILD/patch -maxdepth 4 -name 'apply.sh' 2> /dev/null | sort` \
+         `test -d vendor && find -L vendor/extra/patch/device/$CUSTOM_BUILD -maxdepth 4 -name 'apply.sh' 2> /dev/null | sort`
+do
+    echo -e ${CL_YLW}"\nPatching device-tree -> $f\n"${CL_RST}
+    . $f
+done
+unset f
+}
+
 if [ "x$SHELL" != "x/bin/bash" ]; then
     case `ps -o command -p $$` in
         *bash*)
-- 
2.11.0

