From e1056f378f92accddc3f77985a36cfbd4827feb2 Mon Sep 17 00:00:00 2001
From: Ivan Iskandar <iiiiskandar14@gmail.com>
Date: Sat, 28 Jan 2017 13:40:55 +0100
Subject: [PATCH 15/15] Set external settings icon tint mode to SRC_ATOP

With "Expose color for external settings icons" commit, themers can change
the color of the external settings icon to whatever they want except
transparent. When they set the tint color to transparent the icon will be
dissapeared, this commits fixed the problem by changing the tint mode.

Before: http://i.imgur.com/ghDPs27.jpg
After: http://i.imgur.com/AUEFgNO.jpg

Change-Id: I65b710e2abefd1052b3af154a98247de9b4fe98d
---
 src/com/android/settings/dashboard/DashboardAdapter.java | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/src/com/android/settings/dashboard/DashboardAdapter.java b/src/com/android/settings/dashboard/DashboardAdapter.java
index 6b2ac30c8..edbf3b2eb 100644
--- a/src/com/android/settings/dashboard/DashboardAdapter.java
+++ b/src/com/android/settings/dashboard/DashboardAdapter.java
@@ -19,6 +19,7 @@ import android.content.Context;
 import android.content.pm.PackageManager;
 import android.graphics.drawable.Drawable;
 import android.graphics.drawable.Icon;
+import android.graphics.PorterDuff.Mode;
 import android.os.Bundle;
 import android.support.v7.widget.PopupMenu;
 import android.support.v7.widget.RecyclerView;
@@ -129,6 +130,11 @@ public class DashboardAdapter extends RecyclerView.Adapter<DashboardAdapter.Dash
                     // If this drawable is coming from outside Settings, tint it to match the
                     // color.
                     tile.icon.setTint(mContext.getColor(R.color.external_icon_tint));
+                    if (tintColorValue.type == TypedValue.TYPE_ATTRIBUTE) {
+                        mContext.getTheme().resolveAttribute(tintColorValue.data,
+                                tintColorValue, true);
+                    }
+                    tile.icon.setTint(tintColorValue.data).setTintMode(Mode.SRC_ATOP);
                 }
             }
         }
-- 
2.11.1

