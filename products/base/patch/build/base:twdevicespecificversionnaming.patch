From 9add1671916d894b86ebbe892531f8f3609454b3 Mon Sep 17 00:00:00 2001
From: sub77 <darfpunk@gmx.de>
Date: Wed, 21 Dec 2016 16:05:17 +0000
Subject: [PATCH] twdevicespecificversionnaming

Change-Id: I015ec8be5d2318ebe6da8159cecb5faf7e777cb2
Signed-off-by: sub77 <darfpunk@gmx.de>
---
 core/Makefile       | 4 ++++
 core/definitions.mk | 6 +++++-
 2 files changed, 9 insertions(+), 1 deletion(-)

diff --git a/core/Makefile b/core/Makefile
index 359a272..3ba25f8 100644
--- a/core/Makefile
+++ b/core/Makefile
@@ -284,8 +284,12 @@ endif
 build_desc :=
 
 ifeq (,$(filter true, $(TARGET_NO_KERNEL) $(TARGET_NO_RECOVERY)))
+ifeq ($(TW_DEVICE_SPECIFIC_VERSION),)
 INSTALLED_RECOVERYIMAGE_TARGET := $(PRODUCT_OUT)/recovery.img
 else
+INSTALLED_RECOVERYIMAGE_TARGET := $(PRODUCT_OUT)/twrp-$(TW_DEVICE_SPECIFIC_VERSION)-$(TARGET_DEVICE)-$(shell date -u +%Y%m%d%H%M).img
+endif
+else
 INSTALLED_RECOVERYIMAGE_TARGET :=
 endif
 
diff --git a/core/definitions.mk b/core/definitions.mk
index 2a72683..ef61226 100644
--- a/core/definitions.mk
+++ b/core/definitions.mk
@@ -2362,9 +2362,13 @@ $(if $(2), \
   onepct=$$((((($(2) / 100) - 1) / img_blocksize + 1) * img_blocksize)); \
   reserve=$$((twoblocks > onepct ? twoblocks : onepct)); \
   maxsize=$$(($(2) - reserve)); \
-  echo "$$printname maxsize=$$maxsize blocksize=$$img_blocksize total=$$total reserve=$$reserve"; \
+  echo -e "\033[32m"; \
+  echo "$$printname">/dev/null; \
+  echo "maxsize=$$maxsize blocksize=$$img_blocksize total=$$total reserve=$$reserve"; \
   if [ "$$total" -gt "$$maxsize" ]; then \
+    echo -e "\033[31m"; \
     echo "error: $$printname too large ($$total > [$(2) - $$reserve])"; \
+    echo -e "\033[0m"; \
     false; \
   elif [ "$$total" -gt $$((maxsize - 32768)) ]; then \
     echo "WARNING: $$printname approaching size limit ($$total now; limit $$maxsize)"; \
-- 
2.1.4

